<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Historial de Recorridos</ion-title>
  </ion-toolbar>

  <!-- Barra de búsqueda -->
  <ion-toolbar>
    <ion-searchbar
      [(ngModel)]="searchTerm"
      (ionInput)="filterTours()"
      placeholder="Buscar por fecha o notas..."
      [animated]="true">
    </ion-searchbar>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Filtros -->
  <div class="filters-section ion-padding">
    <ion-segment [(ngModel)]="filterAttention" (ionChange)="filterTours()">
      <ion-segment-button value="Todas">
        <ion-label>Todas</ion-label>
      </ion-segment-button>
      <ion-segment-button value="Alta">
        <ion-label>Alta</ion-label>
      </ion-segment-button>
      <ion-segment-button value="Media">
        <ion-label>Media</ion-label>
      </ion-segment-button>
      <ion-segment-button value="Baja">
        <ion-label>Baja</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>

  <!-- Estadísticas Rápidas -->
  <ion-card class="summary-card">
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="4" class="summary-item">
            <h3>{{ filteredTours.length }}</h3>
            <p>Recorridos</p>
          </ion-col>
          <ion-col size="4" class="summary-item">
            <h3>{{ calcularDistanciaTotal() }} km</h3>
            <p>Total</p>
          </ion-col>
          <ion-col size="4" class="summary-item">
            <h3>{{ calcularPromedioAtencion() }}</h3>
            <p>Atención</p>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- Lista de Recorridos -->
  <div class="recorridos-list ion-padding">
    @for (tour of filteredTours; track tour.id) {
      <ion-card class="recorrido-card">
        <ion-card-header>
          <ion-card-subtitle>
            <ion-icon name="calendar-outline"></ion-icon>
            {{ tour.date | date: 'EEEE, dd/MM/yyyy' }}
          </ion-card-subtitle>
          <ion-card-title>
            <ion-icon name="time-outline"></ion-icon>
            {{ tour.date | date: 'HH:mm' }}
          </ion-card-title>
        </ion-card-header>

        <ion-card-content>
          <ion-grid>
            <ion-row>
              <ion-col size="6">
                <div class="data-item">
                  <ion-icon name="navigate-outline" color="primary"></ion-icon>
                  <div>
                    <h4>{{ tour.distance }} km</h4>
                    <p>Distancia</p>
                  </div>
                </div>
              </ion-col>
              <ion-col size="6">
                <div class="data-item">
                  <ion-icon name="hourglass-outline" color="success"></ion-icon>
                  <div>
                    <h4>{{ tour.duration }} min</h4>
                    <p>Duración</p>
                  </div>
                </div>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="6">
                <div class="data-item">
                  <ion-icon name="speedometer-outline" color="warning"></ion-icon>
                  <div>
                    <h4>{{ tour.averageSpeed }} km/h</h4>
                    <p>Velocidad</p>
                  </div>
                </div>
              </ion-col>
              <ion-col size="6">
                <div class="data-item">
                  <ion-icon name="eye-outline" [color]="getColorAttention(tour.levelAttention)"></ion-icon>
                  <div>
                    <h4>{{ tour.levelAttention }}</h4>
                    <p>Atención</p>
                  </div>
                </div>
              </ion-col>
            </ion-row>
          </ion-grid>

          <!-- Notas -->
          @if (tour.notes) {
            <div class="notas-section">
              <ion-icon name="document-text-outline"></ion-icon>
              <p>{{ tour.notes }}</p>
            </div>
          }

          <!-- Botones de Acción -->
          <div class="action-buttons">
            <ion-button fill="outline" size="small" (click)="editTour(tour)">
              <ion-icon name="create-outline" slot="start"></ion-icon>
              Editar
            </ion-button>
            <ion-button fill="outline" size="small" color="danger" (click)="confirmDelete(tour)">
              <ion-icon name="trash-outline" slot="start"></ion-icon>
              Eliminar
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    }

    <!-- Estado vacío -->
    @if (filteredTours.length === 0) {
      <div class="empty-state">
        <ion-icon name="search-outline" color="medium"></ion-icon>
        <h2>No se encontraron recorridos</h2>
        @if (searchTerm || filterAttention !== 'Todas') {
          <p>
            Intenta cambiar los filtros de búsqueda
          </p>
        }
        @if (!searchTerm && filterAttention === 'Todas') {
          <p>
            Aún no has registrado ningún recorrido
          </p>
        }
        @if (!searchTerm && filterAttention === 'Todas') {
          <ion-button routerLink="/tabs/register" color="primary">
            <ion-icon name="add-circle" slot="start"></ion-icon>
            Registrar Recorrido
          </ion-button>
        }
      </div>
    }
  </div>
</ion-content>
